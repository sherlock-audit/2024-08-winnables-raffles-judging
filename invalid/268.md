Strong Sangria Yak

High

# Incorrect Bitwise Operation in `_packCCIPContract` Function Leads to `_ccipReceive` Reverts

### Summary

The incorrect bitwise operation in the `_packCCIPContract` function will cause the `counterpart` identifier to be generated improperly. This results in the `_ccipReceive` function failing to validate the CCIP (Cross-Chain Interoperability Protocol) contract, leading to a complete failure to initiate the raffle process when a message is received.

### Root Cause

In [`BaseCCIPContract.sol`](https://github.com/sherlock-audit/2024-08-winnables-raffles/blob/main/public-contracts/contracts/BaseCCIPContract.sol#L40C1-L46C2), the bitwise operation used to pack the `contractAddress` and `chainSelector` into a `bytes32` value is incorrect. The shift operation (`chainSelector << 160`) is misaligned, leading to an incorrect `counterpart` value.



### Impact

The `_ccipReceive` function relies on the `counterpart` value generated by `_packCCIPContract` to verify the sender of the CCIP message. Due to the incorrect `counterpart`, the function fails to recognize valid CCIP contracts and erroneously triggers the `UnauthorizedCCIPSender` revert. This prevents the contract from processing the raffle, leading to the inability to lock the raffle prize and cancel the raffle if the message is invalid. This has critical implications for the functionality of the cross-chain raffle system, as no new raffles can be initiated.

### Code Snippet

```solidity
function _packCCIPContract(address contractAddress, uint64 chainSelector) internal pure returns(bytes32) {
        return bytes32(
            uint256(uint160(contractAddress)) |
            uint256(chainSelector << 160)
        );
    }
}
```

### PoC

```solidity
function testPackCCIPContract() public pure returns (bytes32) {
    // Example input values
    address contractAddress = 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4;
    uint64 chainSelector = 100;

     // Expected output:             0x0000000000000000000000645b38da6a701c568545dcfcb03fcb875f56beddc4
    // Actual output due to the bug: 0x0000000000000000000000005b38da6a701c568545dcfcb03fcb875f56beddc4
    return _packCCIPContract(contractAddress, chainSelector);
}

```


### Mitigation

```solidity
function _packCCIPContract(address contractAddress, uint64 chainSelector) internal pure returns(bytes32) {
    return bytes32(
        (uint256(chainSelector) << 160) | uint256(uint160(contractAddress))
    );
}
```
